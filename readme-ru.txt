Скрипт для запуска sing-box на роутерах Asus с прошивкой Мерлина и флешкой с Entware.

I. Основы.
1. Вы должны уметь составлять, ну или хотя бы править под себя конфиги для sing-box. Документация https://sing-box.sagernet.org/. Шаблон моего конфига устанавливается вместе со скриптом.
2. Поддерживаются роутеры только со следующими архитектурами процессоров- ARMv8/AArch64 и ARMv7/AArch32.
3. Если в настройках вашего роутера включено использование ipv6, то использовать данный скрипт не рекомендуется, т.к. он в большинстве случаев не сможет выполнять своё предназначение.
4. У вас в роутере должна быть примонтированная флешка с установленным на ней Entware. В ней будет установлено ядро sing-box, которым, в процессе его работы, там же будут созданы директория с UI и cache файл. Установка данных компонентов во внутреннюю память роутера не желательна, а часто и невозможна из-за её ограничений, и не рассматривается.
5. Если заметите баги в работе скрипта и/или сможете улучшить/оптимизировать скрипт, поделитесь информацией об этом со мной, пожалуйста.

II. Особенности конфигурирования sing-box на роутере.
1. Вообще, в начале конфигурационного файла sing-box (файл config.json), прописываются DNS серверы и правила для них. Но, в роутере для tun интерфейса sing-box они игнорируются из-за dnsmasq роутера, который перехватывает DNS запросы. В результате, все DNS запросы от устройств, трафик которых направлен через tun интерфейс sing-box, всегда идут на DNS сервер, указанный в настройках роутера. Но настройки DNS в конфигурационном файле всё же необходимы для корректной работы inbouds, которые представляют из себя прокси серверы, например mixed, они используют эти настройки DNS.
2. Не рекомендуется в config.json прописывать clash_mod'ы в правилах DNS, при некоторых настройках и действиях это вызывает почти моментальное поглощение всей оперативной памяти процессом sing-box и зависание роутера.
3. Не используйте в config.json настройку '"auto_route": true', в роутере она не работает корректно и нарушает маршрутизацию.
4. Не используйте в config.json настройку '"strict_route": true', это бессмысленно без '"auto_route": true', а так же может вызывать потерю доступа к консоли роутера и нарушения маршрутизации.
5. При настройке скрипта командой 'sbs setup', не прописывайте вместо ip адресов устройств всю подсеть роутера, например 192.168.50.0/24, это ломает нормальную работу роутера.

III. Установка sing-box.
Выполните в консоли роутера команду:
wget -O /jffs/scripts/sbs-ru https://raw.githubusercontent.com/Dr4tez/sing-box4asus/main/sbs-ru && chmod 775 /jffs/scripts/sbs-ru && /jffs/scripts/sbs-ru install
В конце установки выводятся указания по дальнейшим действиям.

IV. Про ядро sing-box.
Во время установки, по умолчанию скачивается и устанавливается последний стабильный релиз sing-box со страницы https://github.com/SagerNet/sing-box/releases/latest гитхаба разработчика. Если хотите использовать другую версию, то можете заменить файл sing-box в директории /opt/root/sing-box на нужный вам. Только не забудьте дать ему права на выполнение и, при необходимости, изменить конфиг согласно разделу Migration (https://sing-box.sagernet.org/migration/) в документации sing-box.

V. Первоначальная настройка и запуск скрипта.
После установки скрипта, перед первым стартом sing-box, обязательно выполните его настройку! Для этого нужно выполнить в консоли роутера команду
sbs setup
1. Сначала вам будет предложено отредактировать config.json (конфигурационный файл sing-box) в редакторе nano. Если не согласитесь редактировать в nano, то обязательно отредактируйте его удобным вам другим способом (например WinSCP), прежде, чем перейти к следующему пункту. config.json находится в директории /jffs/addons/sing-box-script. Как минимум, вы должны вписать свои значения в поля с иксами в config.json. Само собой, вы можете вообще заменить конфиг на свой, но с учётом особенностей конфигурирования sing-box на роутере, указанных в разделе II.
   Обратите внимание, что в данном шаблоне config.json, используется мой личный рулсет, загружаемый с моей страницы гитхаба (https://github.com/Dr4tez/my_domains), в нём может не быть нужных вам заблокированных доменов. Трафик для первого TUN интерфейса маршрутизируется по правилам, прописанным в данном config.json- домены из рулсета и ip 31.131.253.250 идут в proxy туннель, а всё остальное идёт в директ. Трафик для второго TUN интерфейса по умолчанию полностью идёт в proxy туннель.
2. Затем, если в вашем config.json прописаны один или два TUN интерфейса, вам будет предложено вписать свои IP адреса устройств для каждого из данных интерфейсов. Впишите нужные IP адреса, разделяя их только пробелами. Трафик с указанных IP адресов пойдёт через соответствующие TUN интерфейсы sing-box. 
3. И на последнем этапе, если в вашем config.json прописаны один или два TUN интерфейса, вам будет предложено изменить номера таблиц маршрутизации для каждого из данных интерфейсов. Рекомендуется отказаться от их изменения, т.к., скорее всего, указанные там номера не заняты вашим роутером. А заняты они могут быть, только если вы сами так настроили, а значит сами понимаете как лучше поступить в этом случае.
4. После этого вам будет предложено запустить sing-box скрипт. Если готовы, то соглашайтесь.

VI. Обновление.
Для запуска обновления выполните в консоли роутера команду:
sbs update
При её выполнении будут обновлены файлы основного скрипта sbs-ru и скрипта sbs-monitor*, а так же ядра sing-box, если подтвердите его обновление. При этом ваш config.json останется нетронутым, как и настройки скрипта, т.к. они хранятся в отдельном файле sbs-conf.

VII. Команды управления.
Для запуска скрипта sing-box выполните в консоли роутера команду:
sbs start
Если хотите полностью остановить работу скрипта и не хотите чтобы скрипт самостоятельно запускался при перезагрузке роутера, то выполните в консоли команду:
sbs stop
Полный список команд с их описанием можете увидеть, выполнив в консоли команду:
sbs

*sbs-monitor- вспомогательный скрипт, который активен только во время работы sing-box. Он мониторит и восстанавливает правила и маршруты, созданные основным скриптом, если они были удалены при некоторых системных событиях.
