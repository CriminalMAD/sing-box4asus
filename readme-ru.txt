Скрипт для запуска sing-box на роутерах Asus с прошивкой Мерлина и флешкой с Entware.

I. Нюансы.
1.Вы должны уметь составлять, ну или хотя бы править под себя конфиги для sing-box. Документация https://sing-box.sagernet.org/. Шаблон моего конфига устанавливается вместе со скриптом sing-box.
2.У вас в роутере должна быть примонтированная флешка с установленным на ней Entware. В ней будет установлено ядро sing-box, которым, в процессе его работы, там же будут созданы директория с UI и cache файл. Установка данных компонентов во внутреннюю память роутера не желательна, а часто и невозможна из-за её ограничений, и не рассматривается.
3.Прописывание DNS серверов в конфиге для sing-box на роутере ломает правила маршрутизации, прописанные в данном конфиге. Но, у меня нормально работает и без указания DNS серверов в конфиге, при этом используется DNS, настроенный в роутере.
4.Если заметите баги в работе скрипта и/или сможете улучшить/оптимизировать скрипт, поделитесь информацией об этом со мной, пожалуйста.

II. Установка sing-box.
Выполните в консоли роутера команду:
wget -O /jffs/scripts/sbs-ru https://raw.githubusercontent.com/Dr4tez/sing-box4asus/main/sbs-ru && chmod 775 /jffs/scripts/sbs-ru && /jffs/scripts/sbs-ru install
В конце установки выводятся указания по дальнейшим действиям.

III. Про ядро sing-box.
Во время установки, по умолчанию скачивается и устанавливается последний стабильный релиз sing-box со страницы https://github.com/SagerNet/sing-box/releases/latest гитхаба разработчика. Если хотите использовать другую версию, то можете заменить файл sing-box в директории /opt/root/sing-box на нужный вам. Только не забудьте дать ему права на выполнение и, при необходимости, изменить конфиг согласно разделу Migration (https://sing-box.sagernet.org/migration/) в документации sing-box.

IV. Первоначальная настройка скрипта.
После установки скрипта, перед первым стартом sing-box, обязательно выполните его настройку! Для этого нужно выполнить в консоли роутера команду
sbs setup
1.Во первых, в процессе выполнения команды, обязательно впишите свои IP адреса устройств, трафик которых желаете пустить через sing-box.
2.Затем будет предложено отредактировать config.json (конфигурационный файл sing-box) в редакторе nano. Если не согласитесь редактировать в nano, то обязательно отредактируйте его удобным вам другим способом (например WinSCP), прежде, чем впервые запустите sing-box. config.json находится в директории /jffs/addons/sing-box-script. Как минимум, вы должны вписать в поля с иксами шаблона конфига свои значения. Само собой вы можете вообще заменить конфиг на свой, но с учётом указанного выше нюанса №3. Обратите внимание, что в моём шаблоне используется мой личный рулсет, загружаемый с моей страницы гитхаба (https://github.com/Dr4tez/my_domains), в нём может не быть нужных вам заблокированных доменов, а трафик по умолчанию идёт в директ.
3.Номер таблицы маршрутизации можете оставить указанный 555.

V. Обновление.
Для запуска обновления выполните в консоли роутера команду:
sbs update
При её выполнении будут обновлены файлы основного скрипта sbs-ru, скрипта sbs-monitor* и ядра sing-box, если подтвердите его обновление. При этом ваш config.json останется нетронутым, как и настройки скрипта, т.к. они хранятся в отдельном файле sbs-conf.

VI. Команды управления.
Для запуска скрипта sing-box выполните в консоли роутера команду:
sbs start
Если хотите полностью остановить работу скрипта и не хотите чтобы скрипт самостоятельно запускался при перезагрузке роутера, то выполните в консоли команду:
sbs stop
Полный список команд с их описанием можете увидеть, выполнив в консоли команду:
sbs

*sbs-monitor- вспомогательный скрипт, который активен только во время работы sing-box. Он мониторит и восстанавливает правила и маршруты, созданные основным скриптом, если они были удалены при некоторых системных событиях.
